"use strict";const MODE_BREAK=1,MODE_FLAT=2;function fits(a,b,c){let d=b.length;for(const e=[a];0<=c;){if(0===e.length){if(0===d)return!0;e.push(b[d-1]),d--;continue}const g=e.pop(),h=g[0],j=g[1],k=g[2];if("string"==typeof k)c-=k.length;else switch(k.type){case"concat":for(var f=k.parts.length-1;0<=f;f--)e.push([h,j,k.parts[f]]);break;case"indent":e.push([h+k.n,j,k.contents]);break;case"group":e.push([h,k.break?MODE_BREAK:j,k.contents]);break;case"if-break":j===MODE_BREAK&&k.breakContents&&e.push([h,j,k.breakContents]),j===MODE_FLAT&&k.flatContents&&e.push([h,j,k.flatContents]);break;case"line":switch(j){case MODE_FLAT:if(!k.hard){k.soft||(c-=1);break}case MODE_BREAK:return!0;}}}return!1}function printDocToString(a,b,c){c=c||"\n";let d=0,e=[[0,MODE_BREAK,a]],f=[],g=!1,h="";for(;0!==e.length;){const k=e.pop(),l=k[0],m=k[1],n=k[2];if("string"==typeof n)f.push(n),d+=n.length;else switch(n.type){case"concat":for(var j=n.parts.length-1;0<=j;j--)e.push([l,m,n.parts[j]]);break;case"indent":e.push([l+n.n,m,n.contents]);break;case"group":switch(m){case MODE_FLAT:if(!g){e.push([l,n.break?MODE_BREAK:MODE_FLAT,n.contents]);break}case MODE_BREAK:g=!1;const o=[l,MODE_FLAT,n.contents];let p=b-d;if(!n.break&&fits(o,e,p))e.push(o);else if(n.expandedStates){const q=n.expandedStates[n.expandedStates.length-1];if(n.break){e.push([l,MODE_BREAK,q]);break}else for(var j=1;j<n.expandedStates.length+1;j++)if(j>=n.expandedStates.length){e.push([l,MODE_BREAK,q]);break}else{const r=n.expandedStates[j],s=[l,MODE_FLAT,r];if(fits(s,e,p)){e.push(s);break}}}else e.push([l,MODE_BREAK,n.contents]);}break;case"if-break":m===MODE_BREAK&&n.breakContents&&e.push([l,m,n.breakContents]),m===MODE_FLAT&&n.flatContents&&e.push([l,m,n.flatContents]);break;case"line-suffix":h+=n.contents;break;case"line":switch(m){case MODE_FLAT:if(!n.hard){n.soft||(f.push(" "),d+=1);break}else g=!0;case MODE_BREAK:n.literal?(f.push(h+c),d=0):(0<f.length&&(f[f.length-1]=f[f.length-1].replace(/[^\S\n]*$/,"")),f.push(h+c+" ".repeat(l)),d=l),h="";}break;default:}}return f.join("")}module.exports={printDocToString};

